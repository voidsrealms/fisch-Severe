local function getCasting()
    while true do
        local Character = game.Players.localPlayer.Character
        if Character then
            local Tool = Character:FindFirstChildOfClass("Tool")
            if Tool and Tool:FindFirstChild("values") then
                local casted = Tool.values:FindFirstChild("casted")
                if casted and string.match(Tool.Name, "Rod") and casted.Value ~= true then
                    mouse1press()
                    wait(1)
                    mouse1release()
                end
            end
        end
        wait()
    end
end

local function Shake()
    local hashPressed = false  -- Track if we've pressed # key

    while true do
        local PlayerGui = game.Players.localPlayer:FindFirstChild("PlayerGui")
        if PlayerGui then
            local shakeui = PlayerGui:FindFirstChild("shakeui")
            if shakeui then
                -- Ensure that # key is pressed only once
                if not hashPressed then
                    keypress(0xB3)  -- Press the # key (0xB3 keycode)
                    wait(0.1)  -- Wait for it to register
                    keyrelease(0xB3)  -- Release the # key
                    hashPressed = true  -- Mark as pressed
                end
                
                -- Press the S key for shake action
                keypress(0x53)    -- S key (shake)
                keyrelease(0x53)
                
                -- Press Enter key to confirm
                keypress(0x0D)    -- Enter key
                keyrelease(0x0D)
                
                wait(0.01)  -- Small wait before the next loop iteration
            else
                -- If shake UI is not present, reset the # press flag
                hashPressed = false
            end
        end
        wait()  -- Wait before continuing the loop
    end
end

local function Reeling()
    local cached = tick() 
    
    while true do
        local playerGui = game.Players.localPlayer:FindFirstChild("PlayerGui")
        local current = tick()
        
        if playerGui then
            local reel = playerGui:FindFirstChild("reel")
            if reel and reel:FindFirstChild("bar") then
                if current - cached > 3 then
                    local playerbar = reel.bar:FindFirstChild("playerbar")
                    local fish = reel.bar:FindFirstChild("fish")
                    
                    if playerbar and fish then
                        local fishX = fish:GetMemoryValue(0x2f0, "float")
                        if fishX then
                            local clampedX = math.clamp(fishX, 0.15, 0.9)
                            playerbar:SetMemoryValue(0x2f0, "float", clampedX)
                        end
                    end
                end
            else
                cached = current
            end
        else
            cached = current
        end
        wait()
    end
end

-- Wrap functions in pcall to catch any errors
local success, error = pcall(function() 
    spawn(getCasting)
end)
if not success then
    print("Casting Error:", error)
end

success, error = pcall(function()
    spawn(Shake)
end)
if not success then
    print("Shake Error:", error)
end

success, error = pcall(function()
    spawn(Reeling)
end)
if not success then
    print("Reeling Error:", error)
end
